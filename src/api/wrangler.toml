# =============================================
# üöÄ PLANAC ERP - API Unificada
# =============================================
# Arquivo: src/api/wrangler.toml
# Atualizado: 27/12/2025 - Corrigido bindings

name = "planac-erp-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# =============================================
# BUILD - Desativado (wrangler compila TS direto)
# =============================================
[build]
command = ""

# =============================================
# VARI√ÅVEIS DE AMBIENTE
# =============================================
[vars]
ENVIRONMENT = "production"
LOG_LEVEL = "info"
NUVEM_FISCAL_URL = "https://api.nuvemfiscal.com.br"
APP_NAME = "PLANAC ERP"
APP_VERSION = "2.0.0"

# =============================================
# D1 DATABASES
# =============================================
[[d1_databases]]
binding = "DB"
database_name = "Planac-erp-database"
database_id = "12f9a7d5-fe09-4b09-bf72-59bae24d65b2"

[[d1_databases]]
binding = "DB_IBPT"
database_name = "planac-erp-ibpt"
database_id = "556b7a7a-0ddd-43b7-8b64-f4ea3ebd9966"

# =============================================
# KV NAMESPACES (corrigido - sem prefixo KV_)
# =============================================
[[kv_namespaces]]
binding = "CACHE"
id = "d053dab81a554dc6961884eae41f75f7"

[[kv_namespaces]]
binding = "SESSIONS"
id = "80c6322699844ba1bb99e841f0c84306"

[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "f9991a8379d74873a8030e42dad416bd"

# =============================================
# R2 BUCKETS
# =============================================
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "planac-erp-storage"

[[r2_buckets]]
binding = "CERTIFICADOS"
bucket_name = "planac-erp-certificados"

[[r2_buckets]]
binding = "DOCS"
bucket_name = "planac-images"

[[r2_buckets]]
binding = "BACKUP"
bucket_name = "planac-cms-media"

# =============================================
# SCHEDULED JOBS (CRON)
# =============================================
[triggers]
crons = [
  "0 6 * * *",
  "0 7 * * *",
  "0 8 * * 1",
  "0 9 1 * *"
]

# =============================================
# AMBIENTES
# =============================================

[env.development]
name = "planac-erp-api-dev"
[env.development.vars]
ENVIRONMENT = "development"
LOG_LEVEL = "debug"

[env.staging]
name = "planac-erp-api-staging"
[env.staging.vars]
ENVIRONMENT = "staging"
LOG_LEVEL = "debug"

[env.production]
name = "planac-erp-api"
[env.production.vars]
ENVIRONMENT = "production"
LOG_LEVEL = "info"

