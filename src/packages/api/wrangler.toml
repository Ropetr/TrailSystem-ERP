# TRAILSYSTEM ERP - Wrangler Configuration
# Atualizado: 02/01/2026 - Rebranding completo Planac -> TrailSystem (KV, R2, D1 migrados)
name = "trailsystem-erp-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Variaveis de ambiente
[vars]
ENVIRONMENT = "production"
LOG_LEVEL = "info"
NUVEM_FISCAL_URL = "https://api.nuvemfiscal.com.br"

# =============================================
# D1 DATABASES
# =============================================
[[d1_databases]]
binding = "DB"
database_name = "trailsystem-erp-database"
database_id = "ca804682-2a6e-4fae-b8a6-12fa923f1560"

[[d1_databases]]
binding = "DB_IBPT"
database_name = "trailsystem-erp-ibpt"
database_id = "f407e97c-e319-4687-962d-976a8c2babf5"

# =============================================
# KV NAMESPACES (IDs CORRIGIDOS)
# =============================================
[[kv_namespaces]]
binding = "CACHE"
id = "d053dab81a554dc6961884eae41f75f7"

[[kv_namespaces]]
binding = "SESSIONS"
id = "80c6322699844ba1bb99e841f0c84306"

[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "f9991a8379d74873a8030e42dad416bd"

# =============================================
# R2 BUCKETS
# =============================================
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "trailsystem-storage"

[[r2_buckets]]
binding = "CERTIFICADOS_BUCKET"
bucket_name = "trailsystem-certificates"

[[r2_buckets]]
binding = "IMAGES"
bucket_name = "trailsystem-images"

[[r2_buckets]]
binding = "CMS_MEDIA"
bucket_name = "trailsystem-cms-media"

# =============================================
# SCHEDULED JOBS (CRON)
# =============================================
[triggers]
crons = [
  "0 6 * * *",
  "0 7 * * *",
  "0 8 * * 1",
  "0 9 1 * *"
]

# =============================================
# OBSERVABILITY
# =============================================
[observability]
enabled = true
