# =============================================
# üöÄ TRAILSYSTEM ERP - Cloudflare Workers Config
# =============================================
# Atualizado em: 02/01/2026
# IDs reais da infraestrutura Cloudflare
# Rebranding: Planac -> TrailSystem

name = "trailsystem-erp-api"
main = "packages/api/src/index.ts"
compatibility_date = "2024-01-01"

# Ambiente de desenvolvimento
[env.development]
name = "trailsystem-erp-api-dev"
vars = { ENVIRONMENT = "development", NUVEM_FISCAL_URL = "https://api.sandbox.nuvemfiscal.com.br" }

# Ambiente de staging
[env.staging]
name = "trailsystem-erp-api-staging"
vars = { ENVIRONMENT = "staging", NUVEM_FISCAL_URL = "https://api.nuvemfiscal.com.br" }

# Ambiente de produ√ß√£o
[env.production]
name = "trailsystem-erp-api"
vars = { ENVIRONMENT = "production", NUVEM_FISCAL_URL = "https://api.nuvemfiscal.com.br" }

# =============================================
# üóÑÔ∏è DATABASE - Cloudflare D1
# =============================================
[[d1_databases]]
binding = "DB"
database_name = "Planac-erp-database"
database_id = "12f9a7d5-fe09-4b09-bf72-59bae24d65b2"

# Migrations
migrations_dir = "packages/api/migrations"

# =============================================
# üì¶ KV NAMESPACES
# =============================================
[[kv_namespaces]]
binding = "CACHE"
id = "d053dab81a554dc6961884eae41f75f7"

[[kv_namespaces]]
binding = "SESSIONS"
id = "80c6322699844ba1bb99e841f0c84306"

[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "f9991a8379d74873a8030e42dad416bd"

# =============================================
# üóÇÔ∏è R2 STORAGE
# =============================================
[[r2_buckets]]
binding = "FILES"
bucket_name = "planac-erp-storage"

# =============================================
# üîê SECRETS (Configurar via wrangler secret put)
# =============================================
# JWT_SECRET              - Chave para tokens JWT
# ENCRYPTION_KEY          - Chave para criptografia de dados sens√≠veis
# CERTIFICADO_DIGITAL_SENHA - Senha do certificado digital (A1)
# WEBHOOK_SECRET          - Chave para valida√ß√£o de webhooks
#
# üßæ NUVEM FISCAL
# NUVEM_FISCAL_CLIENT_ID     - AJReDlHes8aBNlTzTF9X
# NUVEM_FISCAL_CLIENT_SECRET - 3yMYNk2hzBLQihujZf0jfFyAKDRc403v4D1SBDFL
#
# Para configurar:
# wrangler secret put NUVEM_FISCAL_CLIENT_ID
# wrangler secret put NUVEM_FISCAL_CLIENT_SECRET

# =============================================
# üåê ROUTES
# =============================================
# routes = [
#   { pattern = "api.planac.com.br/*", zone_name = "planac.com.br" }
# ]

# =============================================
# üìä OBSERVABILITY
# =============================================
[observability]
enabled = true

# =============================================
# ‚ö° BUILD
# =============================================
[build]
command = "npm run build"
cwd = "packages/api"
watch_dir = "packages/api/src"
